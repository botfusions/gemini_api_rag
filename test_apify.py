"""
Apify Subtitle Testi
Apify'Ä±n altyazÄ± Ã§ekme Ã¶zelliÄŸini test eder
"""

from apify_client import ApifyClient
from dotenv import load_dotenv
import os

load_dotenv()

client = ApifyClient(os.getenv('APIFY_API_KEY'))
video_url = "https://youtu.be/VtHvkBWToJs"

# Apify dokÃ¼mantasyonuna gÃ¶re doÄŸru parametreler
run_input = {
    "startUrls": [{"url": video_url}],
    "downloadSubtitles": True,  # AltyazÄ±larÄ± indir
    "saveSubtitlesToKVS": True,  # Key-Value Store'a kaydet
    "subtitleLang": "en",  # Ä°ngilizce altyazÄ±
    "preferAutoGeneratedSubtitles": False,  # Manuel altyazÄ±larÄ± tercih et
}

print("ğŸ§ª Apify actor test ediliyor...")
print(f"ğŸ“º Video: {video_url}")
print(f"âš™ï¸ Parametreler: {run_input}")
print()

try:
    # Actor'Ã¼ Ã§alÄ±ÅŸtÄ±r
    run = client.actor("streamers/youtube-scraper").call(run_input=run_input)

    print("âœ… Actor Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±")
    print(f"ğŸ†” Run ID: {run.get('id')}")
    print()

    # Dataset sonuÃ§larÄ±nÄ± kontrol et
    print("ğŸ“Š Dataset sonuÃ§larÄ±:")
    for item in client.dataset(run["defaultDatasetId"]).iterate_items():
        print(f"  Video BaÅŸlÄ±ÄŸÄ±: {item.get('title', 'N/A')}")
        print(f"  Subtitles (dataset): {item.get('subtitles', 'YOK')}")
        print()
        break

    # Key-Value Store'u kontrol et
    print("ğŸ”‘ Key-Value Store kontrol ediliyor...")
    kvs_id = run.get("defaultKeyValueStoreId")
    if kvs_id:
        print(f"  KVS ID: {kvs_id}")
        # KVS'deki kayÄ±tlarÄ± listele
        kvs_client = client.key_value_store(kvs_id)
        # Genellikle altyazÄ±lar "subtitles" veya video ID ile kaydedilir
        print("  KVS iÃ§eriÄŸi kontrol ediliyor...")
    else:
        print("  âš ï¸ KVS ID bulunamadÄ±")

except Exception as e:
    print(f"âŒ Hata: {str(e)}")
    import traceback
    print(traceback.format_exc())
